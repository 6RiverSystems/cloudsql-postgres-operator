apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: cloudsql-operator
  name: cloudsql-operator
  namespace: cloudsql-operator
data:
  config.toml: |
    [logging]
    level = "trace"
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: cloudsql-operator
  name: cloudsql-operator
  namespace: cloudsql-operator
spec:
  selector:
    app: cloudsql-operator
  ports:
  - name: admission
    port: 443
    targetPort: 443
  type: ClusterIP
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    app: cloudsql-operator
  name: cloudsql-operator
  namespace: cloudsql-operator
spec:
  containers:
  - name: cloudsql-operator
    image: "gcr.io/<project-id>/cloudsql-operator"
    imagePullPolicy: IfNotPresent
    args:
    - /cloudsql-operator
    - --config-file
    - /cfg/config.toml
    ports:
    - name: admission
      containerPort: 443
    readinessProbe:
      httpGet:
        path: /healthz
        port: admission
        scheme: HTTPS
    volumeMounts:
    - mountPath: /cfg/config.toml
      subPath: config.toml
      name: cfg
      readOnly: true
  volumes:
  - name: cfg
    configMap:
      name: cloudsql-operator
  serviceAccountName: cloudsql-operator
